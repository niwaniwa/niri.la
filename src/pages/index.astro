---
import BaseLayout from "../layouts/BaseLayout.astro";
import Archive from "../components/Archive.astro";
import CardSquare from "../components/CardSquare.astro";
import { Icon } from "astro-icon/components";
import { getCollection } from "astro:content";
import ProfileSidebar from "../components/ProfileSidebar.astro";

const works = (await getCollection("works")).sort(
  (a, b) => b.data.pubDate.valueOf() - a.data.pubDate.valueOf(),
);

const blogs = (await getCollection("blogs", ({ data }) => !data.draft)).sort(
  (a, b) => b.data.pubDate.valueOf() - a.data.pubDate.valueOf(),
);

const displayBlogs = blogs.slice(0, 10);
---

<BaseLayout title="にりらだょ" hideHeader>
  <main class="max-w-4xl mx-auto px-4 py-12">
    <div class="lg:flex lg:gap-12">
      <ProfileSidebar />

      <div class="flex-1 space-y-16">
        <!-- プロフィールセクション -->
        <section class="my-20 flex items-center justify-center">
          <div class="flex flex-col items-center gap-4">
            <!-- アイコン画像 -->
            <img
              src="/images/icon.png"
              alt="アイコン"
              class="w-50 h-50 rounded-full"
            />
            <!-- 名前と自己紹介 -->
            <h1 class="text-4xl font-bold">nirila</h1>
            <p>にりら</p>
            <div>
              <p class="text-base-content/70">engineer, creator</p>
            </div>
            <ul class="flex gap-4">
              <li>
                <a
                  href="https://github.com/niwaniwa"
                  class="text-primary hover:text-primary/80"
                >
                  <Icon name="mdi:github" class="w-6 h-6" />
                </a>
              </li>
              <li>
                <a
                  href="https://x.com/ni_rilana"
                  class="text-primary hover:text-primary/80"
                >
                  <Icon name="mdi:twitter" class="w-6 h-6" />
                </a>
              </li>
              <li>
                <a
                  href="https://misskey.niri.la/@ni_rilana"
                  class="text-primary hover:text-primary/80">Misskey</a
                >
              </li>
            </ul>
          </div>
        </section>
        <Archive works={works} limit={5} />

        <!-- blogs -->
        <section>
          <div class="flex justify-between items-center mb-6">
            <h2 class="text-2xl font-bold">Blog</h2>
            <a href="/blog" class="text-primary text-sm hover:underline">
              すべて見る →
            </a>
          </div>

          <div
            class="grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-5 gap-4"
          >
            {
              displayBlogs.map((post) => (
                <CardSquare
                  title={post.data.title}
                  href={`/blog/${post.id.replace(/\.md$/, "")}`}
                  pubDate={post.data.pubDate}
                  emoji={post.data.emoji}
                  image={post.data.image}
                />
              ))
            }
          </div>
        </section>
      </div>
    </div>
  </main>
</BaseLayout>
