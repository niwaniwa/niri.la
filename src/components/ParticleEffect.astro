---
interface Props {
  colors?: string[];
  interval?: number;
}

const {
  colors = ["#fb7185", "#f472b6", "#c084fc", "#a78bfa"],
  interval = 2000,
} = Astro.props;
---

<div
  class="particle-effect"
  data-colors={JSON.stringify(colors)}
  data-interval={interval}
>
  <slot />
</div>

<style is:global>
  .particle-effect {
    position: relative;
    overflow: visible;
  }

  .particle {
    position: absolute;
    width: 6px;
    height: 6px;
    border-radius: 50%;
    pointer-events: none;
    animation: particle-float 15s ease-in-out;
    z-index: 0;
  }

  @keyframes particle-float {
    0% {
      opacity: 0;
      transform: translate(0, 0) scale(0.5);
    }
    20% {
      opacity: 1;
      transform: translate(var(--dx1), var(--dy1)) scale(1);
    }
    50% {
      opacity: 0.8;
      transform: translate(var(--dx2), var(--dy2)) scale(0.8);
    }
    80% {
      opacity: 0.4;
      transform: translate(var(--dx3), var(--dy3)) scale(0.6);
    }
    100% {
      opacity: 0;
      transform: translate(var(--dx4), var(--dy4)) scale(0);
    }
  }
</style>

<script>
  function setupParticles() {
    document.querySelectorAll(".particle-effect").forEach((container) => {
      const colors = JSON.parse(container.getAttribute("data-colors") || "[]");
      const interval = Number(container.getAttribute("data-interval") || 2000);

      function createParticle() {
        const particle = document.createElement("span");
        particle.classList.add("particle");
        const rect = container.getBoundingClientRect();
        const x = Math.random() * rect.width * 1.2;
        const y = Math.random() * rect.height * 1.4;

        particle.style.left = `${x}px`;
        particle.style.top = `${y}px`;
        particle.style.backgroundColor =
          colors[Math.floor(Math.random() * colors.length)];

        const randomMove = () => (Math.random() - 0.5) * 60;
        particle.style.setProperty("--dx1", `${randomMove()}px`);
        particle.style.setProperty("--dy1", `${randomMove()}px`);
        particle.style.setProperty("--dx2", `${randomMove()}px`);
        particle.style.setProperty("--dy2", `${randomMove()}px`);
        particle.style.setProperty("--dx3", `${randomMove()}px`);
        particle.style.setProperty("--dy3", `${randomMove()}px`);
        particle.style.setProperty("--dx4", `${randomMove()}px`);
        particle.style.setProperty("--dy4", `${randomMove()}px`);

        container.appendChild(particle);

        particle.addEventListener("animationend", () => {
          particle.remove();
        });
      }

      setInterval(createParticle, interval);
    });
  }

  setupParticles();
  document.addEventListener("astro:page-load", setupParticles);
</script>
