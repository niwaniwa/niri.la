---
import { Icon } from "astro-icon/components";
---

<button
  type="button"
  class="theme-toggle text-secondary-content hover:text-accent cursor-pointer"
  aria-label="ダークモード切り替え"
>
  <Icon name="mdi:theme-light-dark" size={24} />
</button>

<script>
  function setupThemeToggles() {
    const toggles = document.querySelectorAll(".theme-toggle");

    toggles.forEach((toggle) => {
      // クローンで既存リスナーをリセット
      const newToggle = toggle.cloneNode(true);
      toggle.parentNode?.replaceChild(newToggle, toggle);

      newToggle.addEventListener("click", () => {
        const element = document.documentElement;
        element.classList.toggle("dark");
        const isDark = element.classList.contains("dark");
        localStorage.setItem("theme", isDark ? "dark" : "light");
      });
    });
  }

  setupThemeToggles();
  document.addEventListener("astro:page-load", setupThemeToggles);
</script>
